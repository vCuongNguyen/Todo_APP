<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo App - Calendar & Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="app">
    <header class="header">
      <h1>Todo App</h1>
      <div class="header-actions">
        <div id="auth-ui" class="auth-ui">
          <span id="auth-user" class="auth-user"></span>
          <button type="button" id="btn-login" class="btn btn-secondary" style="display:none">ƒêƒÉng nh·∫≠p Google</button>
          <button type="button" id="btn-logout" class="btn btn-secondary" style="display:none">ƒêƒÉng xu·∫•t</button>
        </div>
        <span id="header-points" class="header-points" title="ƒêi·ªÉm t√≠ch l≈©y">‚≠ê <span id="header-points-value">0</span> pts</span>
        <button type="button" id="btn-kpi" class="btn btn-icon" title="KPI">üéØ</button>
        <button type="button" id="btn-add-task" class="btn btn-primary">+ Th√™m task</button>
        <button type="button" id="btn-settings" class="btn btn-secondary">C√†i ƒë·∫∑t</button>
      </div>
    </header>

    <nav class="tabs">
      <button type="button" class="tab active" data-tab="calendar">Calendar</button>
      <button type="button" class="tab" data-tab="today">‚ö° L·ªãch h√¥m nay</button>
      <button type="button" class="tab" data-tab="dashboard">Dashboard</button>
      <button type="button" class="tab" data-tab="tasks">Danh s√°ch task</button>
      <button type="button" class="tab" data-tab="projects">üìÅ Project</button>
    </nav>

    <!-- Tab Calendar -->
    <section id="panel-calendar" class="panel active">
      <div class="calendar-toolbar">
        <button type="button" id="cal-prev">‚Üê</button>
        <span id="cal-title"></span>
        <button type="button" id="cal-next">‚Üí</button>
        <button type="button" id="cal-today" class="btn btn-secondary">H√¥m nay</button>
        <button type="button" id="btn-fixed-schedule" class="btn btn-secondary">L·ªãch c·ªë ƒë·ªãnh</button>
        <div id="day-slot-wrap" class="day-slot-wrap" style="display:none">
          <label for="day-slot-interval" class="day-slot-label">Kho·∫£ng:</label>
          <select id="day-slot-interval" class="day-slot-interval" title="ƒê·ªô d√†i m·ªói √¥ gi·ªù trong xem ng√†y">
            <option value="30">30 ph√∫t</option>
            <option value="60" selected>1 gi·ªù</option>
            <option value="240">4 gi·ªù</option>
          </select>
        </div>
        <div class="cal-mode">
          <button type="button" class="mode-btn active" data-mode="day">Ng√†y</button>
          <button type="button" class="mode-btn" data-mode="week">Tu·∫ßn</button>
          <button type="button" class="mode-btn" data-mode="month">Th√°ng</button>
          <button type="button" class="mode-btn" data-mode="year">NƒÉm</button>
        </div>
      </div>
      <div id="calendar-day-info" class="calendar-day-info" aria-live="polite"></div>
      <div id="calendar-container" class="calendar-container"></div>
      <div id="day-schedule-section" class="day-schedule-section">
        <h3>L·ªãch trong ng√†y (t·ª± ƒë·ªông s·∫Øp x·∫øp)</h3>
        <div id="day-timeline" class="day-timeline"></div>
        <h4>H√†ng ch·ªù (kh√¥ng ƒë·ªß th·ªùi gian)</h4>
        <div id="queue-list" class="queue-list"></div>
      </div>
    </section>

    <!-- Tab L·ªãch h√¥m nay -->
    <section id="panel-today" class="panel">
      <div class="today-panel-header">
        <div class="today-panel-head-row">
          <h2 class="today-panel-title">L·ªãch h√¥m nay</h2>
          <span id="today-current-time" class="today-current-time" aria-live="polite"></span>
        </div>
        <p class="today-panel-sub">T·ª± ƒë·ªông s·∫Øp x·∫øp theo ∆∞u ti√™n & th·ªùi gian r·∫£nh</p>
      </div>
      <div id="today-timeline" class="day-timeline today-timeline"></div>
      <h4 class="today-queue-title">H√†ng ch·ªù (kh√¥ng ƒë·ªß th·ªùi gian)</h4>
      <div id="today-queue" class="queue-list"></div>
    </section>

    <!-- Tab Dashboard (ch·ªâ th·ªëng k√™ + bi·ªÉu ƒë·ªì) -->
    <section id="panel-dashboard" class="panel">
      <div id="dashboard-stats-cards" class="dashboard-stats-cards"></div>
      <div class="stats-section">
        <h3>Th·ªëng k√™</h3>
        <div class="stats-period">
          <button type="button" class="period-btn active" data-period="day">Ng√†y</button>
          <button type="button" class="period-btn" data-period="week">Tu·∫ßn</button>
          <button type="button" class="period-btn" data-period="month">Th√°ng</button>
          <button type="button" class="period-btn" data-period="year">NƒÉm</button>
        </div>
        <div class="chart-wrap">
          <canvas id="stats-chart"></canvas>
        </div>
        <div class="stats-task-list-wrap">
          <h4>Chi ti·∫øt task trong k·ª≥</h4>
          <div id="stats-task-list" class="stats-task-list"></div>
        </div>
      </div>
      <div class="kpi-rewards-section">
        <h3>KPI & Rewards</h3>
        <div id="kpi-config" class="kpi-config"></div>
        <div id="rewards-display" class="rewards-display"></div>
      </div>
    </section>

    <!-- Tab Danh s√°ch task -->
    <section id="panel-tasks" class="panel">
      <div class="dashboard-toolbar">
        <input type="text" id="dashboard-search" class="dashboard-search" placeholder="T√¨m task theo t√™n..." />
        <div id="dashboard-filter-pills" class="dashboard-filter-pills"></div>
        <div class="dashboard-filter-extra">
          <select id="filter-priority" class="filter-select" title="L·ªçc theo ƒë·ªô quan tr·ªçng">
            <option value="">∆Øu ti√™n</option>
            <option value="important_urgent">Quan tr·ªçng + G·∫•p</option>
            <option value="important_not_urgent">Quan tr·ªçng</option>
            <option value="not_important_urgent">G·∫•p</option>
            <option value="not_important_not_urgent">Th·∫•p</option>
          </select>
          <select id="filter-project" class="filter-select" title="L·ªçc theo project">
            <option value="">Project</option>
          </select>
          <input type="date" id="filter-date" class="filter-date" title="L·ªçc theo deadline ng√†y" />
          <input type="month" id="filter-month" class="filter-month" title="L·ªçc theo deadline th√°ng" />
        </div>
      </div>
      <div class="dashboard-sort"><span>S·∫Øp x·∫øp theo th·ªùi gian & ƒë·ªô ∆∞u ti√™n</span></div>
      <div id="dashboard-tasks" class="dashboard-tasks"></div>
    </section>

    <!-- Tab Project: th·ªëng k√™ theo project -->
    <section id="panel-projects" class="panel">
      <div class="projects-header">
        <h2>Th·ªëng k√™ theo Project</h2>
        <div class="projects-add">
          <input type="text" id="project-name-input" class="project-name-input" placeholder="T√™n project" />
          <input type="color" id="project-color-input" class="project-color-input" value="#7c6fff" title="M√†u" />
          <button type="button" id="btn-add-project" class="btn btn-primary">+ Th√™m project</button>
        </div>
      </div>
      <div id="projects-list" class="projects-list"></div>
    </section>
  </div>

  <!-- Modal: Task form -->
  <div id="modal-task" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-task-title">Th√™m task</h2>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <form id="form-task">
        <input type="hidden" id="task-id" />
        <input type="hidden" id="task-parent-id" />
        <div class="form-group">
          <label>T√™n task *</label>
          <input type="text" id="task-name" required placeholder="T√™n task" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Th·ªùi gian ∆∞·ªõc l∆∞·ª£ng (ph√∫t) *</label>
            <input type="number" id="task-estimated" min="1" required placeholder="30" />
          </div>
          <div class="form-group">
            <label>Deadline *</label>
            <input type="datetime-local" id="task-deadline" required />
          </div>
        </div>
        <div class="form-group">
          <label>Th·ª±c hi·ªán trong 1 ng√†y hay nhi·ªÅu ng√†y?</label>
          <select id="task-single-day">
            <option value="true">M·ªôt ng√†y</option>
            <option value="false">Nhi·ªÅu ng√†y</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Quan tr·ªçng?</label>
            <select id="task-important">
              <option value="false">Kh√¥ng quan tr·ªçng</option>
              <option value="true">Quan tr·ªçng</option>
            </select>
          </div>
          <div class="form-group">
            <label>G·∫•p?</label>
            <select id="task-urgent">
              <option value="false">‚óã Kh√¥ng g·∫•p</option>
              <option value="true">‚ö° G·∫•p</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Project</label>
          <select id="task-project">
            <option value="">‚Äî Kh√¥ng c√≥ project ‚Äî</option>
          </select>
        </div>
        <div class="form-group">
          <label>Ghi ch√∫</label>
          <textarea id="task-notes" rows="3" placeholder="Ghi ch√∫ cho task..."></textarea>
        </div>
        <div id="task-subtasks-area" class="subtasks-area" style="display:none">
          <label>Task con (subtasks)</label>
          <div id="task-subtasks-list"></div>
          <button type="button" id="btn-add-subtask" class="btn btn-small">+ Th√™m task con</button>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="task-is-parent" /> ƒê√¢y l√† task cha (ch·ª©a nhi·ªÅu task con)</label>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">L∆∞u</button>
          <button type="button" class="btn btn-secondary modal-cancel">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Fixed schedule (l·ªãch c·ªë ƒë·ªãnh trong ng√†y) -->
  <div id="modal-schedule" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>L·ªãch tr√¨nh c·ªë ƒë·ªãnh trong ng√†y</h2>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <p class="hint">C√°c khung gi·ªù n√†y s·∫Ω kh√¥ng d√πng ƒë·ªÉ s·∫Øp x·∫øp task. C√≥ th·ªÉ √°p d·ª•ng: m·ªói ng√†y, m·ªôt ng√†y c·ª• th·ªÉ, th·ª© trong tu·∫ßn (VD: Th·ª© 2), m·ªói N ng√†y, ho·∫∑c ng√†y trong th√°ng.</p>
      <div id="fixed-schedule-list" class="fixed-schedule-list"></div>
      <button type="button" id="btn-add-schedule" class="btn btn-primary">+ Th√™m khung gi·ªù c·ªë ƒë·ªãnh</button>
      <div class="modal-actions">
        <button type="button" id="btn-save-schedule" class="btn btn-primary">L∆∞u</button>
        <button type="button" class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal: Settings (ch·ªâ L∆∞u tr·ªØ, KPI ƒë√£ t√°ch ra) -->
  <div id="modal-settings" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>C√†i ƒë·∫∑t</h2>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div class="settings-section">
        <h3>L∆∞u tr·ªØ</h3>
        <p>D·ªØ li·ªáu l∆∞u tr√™n m√°y (localStorage). ƒêƒÉng nh·∫≠p Google ƒë·ªÉ ƒë·ªìng b·ªô l√™n cloud (Firestore).</p>
        <button type="button" id="btn-export" class="btn btn-secondary">Xu·∫•t d·ªØ li·ªáu</button>
        <button type="button" id="btn-import" class="btn btn-secondary">Nh·∫≠p d·ªØ li·ªáu</button>
        <input type="file" id="import-file" accept=".json" style="display:none" />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal: KPI (t√°ch ri√™ng kh·ªèi C√†i ƒë·∫∑t) -->
  <div id="modal-kpi" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>KPI & Rewards</h2>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div class="settings-section">
        <div class="form-group">
          <label>Lo·∫°i KPI</label>
          <select id="kpi-type">
            <option value="done_ratio">T·ª∑ l·ªá task ho√†n th√†nh (done)</option>
            <option value="completion_ratio">T·ª∑ l·ªá ho√†n th√†nh theo th·ªùi gian</option>
          </select>
        </div>
        <div class="form-group">
          <label>M·ª•c ti√™u (%)</label>
          <input type="number" id="kpi-target" min="0" max="100" value="80" />
        </div>
        <div class="form-group">
          <label>Reward (ƒë·ªÉ tr·ªëng = d√πng points t·ª± ƒë·ªông)</label>
          <input type="text" id="kpi-reward-custom" placeholder="VD: ƒêi ƒÉn kem, ..." />
        </div>
        <button type="button" id="btn-save-kpi" class="btn btn-primary">L∆∞u KPI</button>
      </div>
      <div id="kpi-config" class="kpi-config"></div>
      <div id="rewards-display" class="rewards-display"></div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal: S·ª≠a project (ƒë·ªïi t√™n, m√†u, g·ª° task kh·ªèi project) -->
  <div id="modal-edit-project" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>S·ª≠a project</h2>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <input type="hidden" id="edit-project-id" />
      <div class="form-group">
        <label>T√™n project</label>
        <input type="text" id="edit-project-name" placeholder="T√™n project" />
      </div>
      <div class="form-group">
        <label>M√†u</label>
        <input type="color" id="edit-project-color" title="M√†u" />
      </div>
      <div class="form-group">
        <label>Task thu·ªôc project</label>
        <div id="edit-project-tasks" class="edit-project-tasks-list"></div>
      </div>
      <div class="modal-actions">
        <button type="button" id="edit-project-save" class="btn btn-primary">L∆∞u</button>
        <button type="button" id="edit-project-delete" class="btn btn-delete" title="X√≥a project">X√≥a project</button>
        <button type="button" class="btn btn-secondary modal-cancel">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal: Chi ti·∫øt task (xem/s·ª≠a, 3 tab Info / Sub / Note) -->
  <div id="modal-task-detail" class="modal">
    <div class="modal-content modal-content-lg">
      <div class="modal-header modal-header-actions">
        <div class="modal-title-row">
          <span id="detail-task-dot" class="detail-task-dot"></span>
          <h2 id="detail-task-title" class="detail-task-title">Task</h2>
        </div>
        <div class="modal-header-buttons">
          <button type="button" id="detail-btn-done" class="btn btn-primary btn-sm" title="Done">‚úì Done</button>
          <button type="button" id="detail-btn-delete" class="btn btn-delete btn-sm" title="X√≥a">üóë</button>
          <button type="button" class="modal-close">&times;</button>
        </div>
      </div>
      <div class="detail-tabs">
        <button type="button" class="detail-tab active" data-detail-tab="info">üìù Info</button>
        <button type="button" class="detail-tab" data-detail-tab="sub">üîÄ Sub</button>
        <button type="button" class="detail-tab" data-detail-tab="note">üí¨ Note</button>
      </div>
      <div id="detail-panel-info" class="detail-panel active">
        <div class="form-group">
          <label>T√™n task *</label>
          <input type="text" id="detail-task-name" placeholder="T√™n task" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Th·ªùi gian ∆∞·ªõc l∆∞·ª£ng (ph√∫t) *</label>
            <input type="number" id="detail-task-estimated" min="1" placeholder="30" />
          </div>
          <div class="form-group">
            <label>Deadline *</label>
            <input type="datetime-local" id="detail-task-deadline" />
          </div>
        </div>
        <div class="form-group">
          <label>Th·ª±c hi·ªán trong 1 ng√†y hay nhi·ªÅu ng√†y?</label>
          <select id="detail-task-single-day">
            <option value="true">M·ªôt ng√†y</option>
            <option value="false">Nhi·ªÅu ng√†y</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Quan tr·ªçng?</label>
            <select id="detail-task-important">
              <option value="false">Kh√¥ng quan tr·ªçng</option>
              <option value="true">Quan tr·ªçng</option>
            </select>
          </div>
          <div class="form-group">
            <label>G·∫•p?</label>
            <select id="detail-task-urgent">
              <option value="false">‚óã Kh√¥ng g·∫•p</option>
              <option value="true">‚ö° G·∫•p</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Project</label>
          <select id="detail-task-project">
            <option value="">‚Äî Kh√¥ng c√≥ project ‚Äî</option>
          </select>
        </div>
        <button type="button" id="detail-btn-save-info" class="btn btn-primary">üíæ L∆∞u</button>
      </div>
      <div id="detail-panel-sub" class="detail-panel">
        <div id="detail-subtasks-list" class="detail-subtasks-list"></div>
        <button type="button" id="detail-btn-add-subtask" class="btn btn-primary">+ Th√™m subtask</button>
      </div>
      <div id="detail-panel-note" class="detail-panel">
        <div class="detail-note-add">
          <textarea id="detail-note-input" rows="2" placeholder="Ghi ch√∫..."></textarea>
          <button type="button" id="detail-btn-add-note" class="btn btn-primary">Ôºã</button>
        </div>
        <div id="detail-notes-list" class="detail-notes-list"></div>
      </div>
    </div>
  </div>

  <script src="firebase-config.js"></script>
  <script src="data.js"></script>
  <script src="auth.js"></script>
  <script src="scheduler.js"></script>
  <script src="calendar.js"></script>
  <script src="dashboard.js"></script>
  <script src="stats.js"></script>
  <script src="kpi.js"></script>
  <script src="app.js"></script>
</body>
</html>
